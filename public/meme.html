<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milady Type A</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #FFFFEE;
            color: #000000;
            line-height: 1.5;
        }

        a {
            color: #0000EE;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
        .nav-links {
    text-align: center;
    margin-bottom: 10px;
}
.nav-links a {
    margin: 0 15px;
    font-size: 16px;
    color: #0000EE;
    text-decoration: none;
}

.nav-links a:hover {
    text-decoration: underline;
    color: #FF0000;
}

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .top-logo {
            max-width: 300px;
        }

        main {
            display: flex;
            flex-direction: row;
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
            padding: 10px;
        }

        .traits-panel {
            background-color: #F0E0D6;
            border: 1px solid #D9BFB7;
            padding: 10px;
            width: 35%; /* Adjusted from 35% to make space for wider panel if needed */
            min-width: 380px; /* Ensure panel is wide enough for controls */
            box-sizing: border-box;
            overflow-y: auto;
            max-height: 80vh;
        }

        .traits-header {
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid #D9BFB7;
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .random-btn {
            background-color: #D9BFB7;
            border: 1px solid #000;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .random-btn:hover {
            background-color: #C0A098;
        }

        .trait {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px; /* Adjusted gap */
        }

        .trait label {
            width: 110px; /* Adjusted width */
            font-size: 14px;
            text-align: right;
            color: #800000;
            flex-shrink: 0; /* Prevent label from shrinking */
        }

        .eye-toggle {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    padding: 0 5px;
    color: #333; /* Default 'on' state color */
    line-height: 1;
    margin-left: 5px; /* Space after label */
    flex-shrink: 0;
}

.eye-toggle.hidden-layer {
    color: #ccc; /* 'Off' state color */
    /* Removed text-decoration: line-through; to avoid confusion with emoji */
}

        .trait-nav {
            flex: 1; /* Allow trait-nav to take remaining space */
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #FFF;
            border: 1px solid #D9BFB7;
            padding: 5px;
            min-width: 180px; /* Adjusted min-width */
        }

        .trait-nav button {
            background: none;
            border: none;
            color: #0000EE;
            font-size: 16px;
            cursor: pointer;
        }

        .trait-nav button:hover {
            color: #FF0000;
        }

        .trait-name {
            flex: 1;
            text-align: center;
            font-size: 14px;
            color: #000;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin: 0 5px; /* Add some margin around the name */
        }

        .image-panel {
            width: 65%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .milady-image {
            background-color: #FFF;
            border: 1px solid #D9BFB7;
            padding: 10px;
            position: relative;
            width: 506px;
            max-width: 100%;
        }

        .milady-image canvas {
            display: block;
            width: 506px; /* Fixed width for canvas */
            height: 634px; /* Fixed height for canvas */
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            background: #F0E0D6;
            padding: 5px;
            border: 1px solid #D9BFB7;
        }

        .image-controls {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
            max-width: 250px;
            background-color: #F0E0D6;
            border: 1px solid #D9BFB7;
            padding: 10px;
        }

        .image-controls input[type="text"] {
            padding: 10px;
            width: 200px;
            background-color: #FFF;
            border: 1px solid #D9BFB7;
            font-size: 14px;
            text-align: center;
        }

        .image-controls input[type="text"]::placeholder {
            color: #666;
        }

        .font-size-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .font-size-control label {
            font-size: 14px;
            color: #800000;
        }

        .font-size-control input[type="range"] {
            width: 200px;
        }

        .glow-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .glow-control label {
            font-size: 14px;
            color: #0000FF;
        }

        .glow-control input[type="checkbox"] {
            width: 16px;
            height: 14px;
        }

        @media (max-width: 800px) {
            main {
                flex-direction: column;
                align-items: center;
            }

            .traits-panel,
            .image-panel {
                width: 100%;
                max-width: 100%;
                min-width: unset; /* Reset min-width for mobile */
            }
            
            .milady-image {
                width: 100%;
            }

            .milady-image canvas {
                width: 100%; /* Make canvas responsive */
                height: auto; /* Maintain aspect ratio */
            }

            .trait-nav {
                min-width: 150px;
            }

            .trait label {
                width: 100px; /* Adjust label width for smaller screens */
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="https://wapal.io/collection/milady-type-a" target="_blank">
            <img src="https://miladytypea.org/assets/miladytype_a_logo.png" alt="Milady Type A Logo" class="top-logo" onerror="this.style.display='none'">
        </a>
    </div>
    <div class="nav-links">
        <a href="https://miladytypea.org/" target="_blank">Website</a>
        <a href="https://wapal.io/collection/milady-type-a" target="_blank">Secondary</a>
        <a href="https://x.com/MiladyOnApt" target="_blank">X</a>
        <a href="https://x.com/MiladyOnApt" target="_blank">Meme Generator</a>
    </div>
    <main>
        <div class="traits-panel">
            <div class="traits-header">
                <span>Assets</span>
                <button class="random-btn" onclick="randomizeTraits()">Random</button>
            </div>
            <div class="trait">
                <label>Background</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('bgs re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="bgs re">
                    <button onclick="changeTrait('bgs re', -1)">‚óÑ</button>
                    <span class="trait-name" id="bgs-re-name">None</span>
                    <button onclick="changeTrait('bgs re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Full Aura</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Full aura re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Full aura re">
                    <button onclick="changeTrait('Full aura re', -1)">‚óÑ</button>
                    <span class="trait-name" id="full-aura-re-name">None</span>
                    <button onclick="changeTrait('Full aura re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Behind Head</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Behind head re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Behind head re">
                    <button onclick="changeTrait('Behind head re', -1)">‚óÑ</button>
                    <span class="trait-name" id="behind-head-re-name">None</span>
                    <button onclick="changeTrait('Behind head re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Bun</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Bun re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Bun re">
                    <button onclick="changeTrait('Bun re', -1)">‚óÑ</button>
                    <span class="trait-name" id="bun-re-name">None</span>
                    <button onclick="changeTrait('Bun re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Body</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Body re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Body re">
                    <button onclick="changeTrait('Body re', -1)">‚óÑ</button>
                    <span class="trait-name" id="body-re-name">None</span>
                    <button onclick="changeTrait('Body re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Face Decoration</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Face decoration re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Face decoration re">
                    <button onclick="changeTrait('Face decoration re', -1)">‚óÑ</button>
                    <span class="trait-name" id="face-decoration-re-name">None</span>
                    <button onclick="changeTrait('Face decoration re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Blush</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Blush re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Blush re">
                    <button onclick="changeTrait('Blush re', -1)">‚óÑ</button>
                    <span class="trait-name" id="blush-re-name">None</span>
                    <button onclick="changeTrait('Blush re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Eyes</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Eyes re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Eyes re">
                    <button onclick="changeTrait('Eyes re', -1)">‚óÑ</button>
                    <span class="trait-name" id="eyes-re-name">None</span>
                    <button onclick="changeTrait('Eyes re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Glasses</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Glasses re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Glasses re">
                    <button onclick="changeTrait('Glasses re', -1)">‚óÑ</button>
                    <span class="trait-name" id="glasses-re-name">None</span>
                    <button onclick="changeTrait('Glasses re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Necklace</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Necklace re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Necklace re">
                    <button onclick="changeTrait('Necklace re', -1)">‚óÑ</button>
                    <span class="trait-name" id="necklace-re-name">None</span>
                    <button onclick="changeTrait('Necklace re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Clothing</label>
                <div class="trait-nav" data-layer="Clothing re">
                    <button onclick="changeTrait('Clothing re', -1)">‚óÑ</button>
                    <span class="trait-name" id="clothing-re-name">None</span>
                    <button onclick="changeTrait('Clothing re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Pin</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Pin re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Pin re">
                    <button onclick="changeTrait('Pin re', -1)">‚óÑ</button>
                    <span class="trait-name" id="pin-re-name">None</span>
                    <button onclick="changeTrait('Pin re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Hair</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Hair re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Hair re">
                    <button onclick="changeTrait('Hair re', -1)">‚óÑ</button>
                    <span class="trait-name" id="hair-re-name">None</span>
                    <button onclick="changeTrait('Hair re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Earring</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Earring re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Earring re">
                    <button onclick="changeTrait('Earring re', -1)">‚óÑ</button>
                    <span class="trait-name" id="earring-re-name">None</span>
                    <button onclick="changeTrait('Earring re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Head</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Head re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Head re">
                    <button onclick="changeTrait('Head re', -1)">‚óÑ</button>
                    <span class="trait-name" id="head-re-name">None</span>
                    <button onclick="changeTrait('Head re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Eyebrows</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Eyebrows re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Eyebrows re">
                    <button onclick="changeTrait('Eyebrows re', -1)">‚óÑ</button>
                    <span class="trait-name" id="eyebrows-re-name">None</span>
                    <button onclick="changeTrait('Eyebrows re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Mouth</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Mouth re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Mouth re">
                    <button onclick="changeTrait('Mouth re', -1)">‚óÑ</button>
                    <span class="trait-name" id="mouth-re-name">None</span>
                    <button onclick="changeTrait('Mouth re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Half Aura</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Half aura', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Half aura">
                    <button onclick="changeTrait('Half aura', -1)">‚óÑ</button>
                    <span class="trait-name" id="half-aura-name">None</span>
                    <button onclick="changeTrait('Half aura', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Item</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Item re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Item re">
                    <button onclick="changeTrait('Item re', -1)">‚óÑ</button>
                    <span class="trait-name" id="item-re-name">None</span>
                    <button onclick="changeTrait('Item re', 1)">‚ñ∫</button>
                </div>
            </div>
            <div class="trait">
                <label>Overlay</label>
                <button class="eye-toggle" onclick="toggleLayerVisibility('Overlay re', this)">üëÅÔ∏è</button>
                <div class="trait-nav" data-layer="Overlay re">
                    <button onclick="changeTrait('Overlay re', -1)">‚óÑ</button>
                    <span class="trait-name" id="overlay-re-name">None</span>
                    <button onclick="changeTrait('Overlay re', 1)">‚ñ∫</button>
                </div>
            </div>
        </div>

        <div class="image-panel">
            <div class="milady-image">
                <canvas id="character-canvas"></canvas>
                </div>
            <div class="image-controls">
                <input type="text" id="top-text" placeholder="Top Text" oninput="updateCharacterImage()">
                <input type="text" id="bottom-text" placeholder="Bottom Text" oninput="updateCharacterImage()">
                <div class="font-size-control">
                    <label id="font-size-label">Font Size: 50px</label>
                    <input type="range" id="font-size-slider" min="20" max="100" value="50" oninput="updateFontSize(this.value)">
                </div>
                <div class="glow-control">
                    <label for="glow-checkbox">Glow Text</label>
                    <input type="checkbox" id="glow-checkbox" onchange="updateGlow(this.checked)">
                </div>
            </div>
        </div>
    </main>

    <script>
        // Constants
        const CANVAS_WIDTH = 723;
        const CANVAS_HEIGHT = 904;
        const GATEWAYS = [
            'https://gateway.pinata.cloud/ipfs/',
            'https://ipfs.io/ipfs/',
            'https://cf-ipfs.com/ipfs/',
            'https://ipfs-gateway.cloud/ipfs/'
        ];
        const API_BASE = 'https://dweb.link/api/v0/ls?arg=';
        const FOLDER_CID = 'bafybeib7t2idfh73u4tdxjbp2xoaprhpmlqei5fhy3m6q27py6vgeqon2a';
        const MAX_RETRIES = 2;
        const CATEGORIES = [
            'bgs re', 'Full aura re', 'Behind head re', 'Bun re', 'Body re',
            'Face decoration re', 'Blush re', 'Eyes re', 'Glasses re', 'Necklace re',
            'Clothing re', 'Pin re', 'Hair re', 'Earring re', 'Head re',
            'Eyebrows re', 'Mouth re', 'Half aura', 'Item re', 'Overlay re'
        ];
        const DRAWING_ORDER = [ 
            { layer: 'bgs re' }, { layer: 'Full aura re' }, { layer: 'Behind head re' }, 
            { layer: 'Bun re' }, { layer: 'Body re' }, { layer: 'Face decoration re' }, 
            { layer: 'Blush re' }, { layer: 'Eyes re' }, { layer: 'Glasses re' }, 
            { layer: 'Necklace re' }, { layer: 'Clothing re' }, { layer: 'Pin re' }, 
            { layer: 'Hair re' }, { layer: 'Earring re' }, { layer: 'Head re' }, 
            { layer: 'Eyebrows re' }, { layer: 'Mouth re' }, { layer: 'Half aura' }, 
            { layer: 'Item re' }, { layer: 'Overlay re' }
        ];
        
        // **IMPORTANT**: Ensure these trait arrays are complete and match your original full dataset.
        // The following are restored based on the earlier version of the code.
        const BACKGROUND_TRAITS = [
            { name: 'Black pyramids', path: 'bgs re/Black%20pyramids.png' }, { name: 'Bridge scene', path: 'bgs re/Bridge%20scene.png' },
            { name: 'C6', path: 'bgs re/C6.png' }, { name: 'Cherry blossom', path: 'bgs re/Cherry%20blossom.png' },
            { name: 'Eclipse', path: 'bgs re/Eclipse.png' }, { name: 'Girls dead monster', path: 'bgs re/Girls%20dead%20monster.png' },
            { name: 'Gundamcar', path: 'bgs re/Gundamcar.png' }, { name: 'Halo 2', path: 'bgs re/Halo%202.png' },
            { name: 'Han', path: 'bgs re/Han.png' }, { name: 'Hatsune', path: 'bgs re/Hatsune.png' },
            { name: 'Honda', path: 'bgs re/Honda.png' }, { name: 'Hueco mundo', path: 'bgs re/Hueco%20mundo.png' },
            { name: 'Izumi van', path: 'bgs re/Izumi%20van.png' }, { name: 'Jesus', path: 'bgs re/Jesus.png' },
            { name: 'Lain', path: 'bgs re/Lain.png' }, { name: 'Paul walker', path: 'bgs re/Paul%20walker.png' },
            { name: 'Peachgini', path: 'bgs re/Peachgini.png' }, { name: 'Rei 2', path: 'bgs re/Rei%202.png' },
            { name: 'Rei van', path: 'bgs re/Rei%20van.png' }, { name: 'Rei', path: 'bgs re/Rei.png' },
            { name: 'Riku and sora', path: 'bgs re/Riku%20and%20sora.png' }, { name: 'Roadside', path: 'bgs re/Roadside.png' },
            { name: 'Rukia bonkai', path: 'bgs re/Rukia%20bonkai.png' }, { name: 'Silvia', path: 'bgs re/Silvia.png' },
            { name: 'Streets', path: 'bgs re/Streets.png' }, { name: 'Tank', path: 'bgs re/Tank.png' },
            { name: 'Train', path: 'bgs re/Train.png' }, { name: 'Twilight town', path: 'bgs re/Twilight%20town.png' },
            { name: 'Ugly miku', path: 'bgs re/Ugly%20miku.png' }, { name: 'UwU', path: 'bgs re/UwU.png' },
            { name: 'Uzi', path: 'bgs re/Uzi.png' }, { name: 'Viper', path: 'bgs re/Viper.png' }
        ];
        const FULL_AURA_TRAITS = [
            { name: 'Apol indigo', path: 'full aura re/Apol%20indigo-resized.png' }, { name: 'Apol iridescent', path: 'full aura re/Apol%20iridescent%20-resized.png' },
            { name: 'Apol pensive', path: 'full aura re/Apol%20pensive-resized.png' }, { name: 'Apol sleepy', path: 'full aura re/Apol%20sleepy-resized.png' },
            { name: 'Apol soft', path: 'full aura re/Apol%20soft-resized.png' }, { name: 'Braid copper', path: 'full aura re/Braid%20copper-resized.png' },
            { name: 'Braid dark', path: 'full aura re/Braid%20dark-resized.png' }, { name: 'Braid grey', path: 'full aura re/Braid%20grey-resized.png' },
            { name: 'Braid iridescent', path: 'full aura re/Braid%20iridescent%20-resized.png' }, { name: 'Braid ketamine', path: 'full aura re/Braid%20ketamine-resized.png' },
            { name: 'Braid purple', path: 'full aura re/Braid%20purple-resized.png' }, { name: 'Braid sweet', path: 'full aura re/Braid%20sweet-resized.png' },
            { name: 'Bright', path: 'full aura re/Bright-resized.png' }, { name: 'Dion bright', path: 'full aura re/Dion%20bright-resized.png' },
            { name: 'Dion copper', path: 'full aura re/Dion%20copper-resized.png' }, { name: 'Dion dark', path: 'full aura re/Dion%20dark-resized.png' },
            { name: 'Dion floating', path: 'full aura re/Dion%20floating-resized.png' }, { name: 'Dion grey', path: 'full aura re/Dion%20grey-resized.png' },
            { name: 'Dion indigo', path: 'full aura re/Dion%20indigo-resized.png' }, { name: 'Dion iridescent', path: 'full aura re/Dion%20iridescent%20-resized.png' },
            { name: 'Dion ketamine', path: 'full aura re/Dion%20ketamine-resized.png' }, { name: 'Dion sleepy (1)', path: 'full aura re/Dion%20sleepy%281%29-resized.png' },
            { name: 'Dion sleepy', path: 'full aura re/Dion%20sleepy-resized.png' }, { name: 'Dion soft', path: 'full aura re/Dion%20soft-resized.png' },
            { name: 'Dion somber', path: 'full aura re/Dion%20somber-resized.png' }, { name: 'Dion sunny', path: 'full aura re/Dion%20sunny-resized.png' },
            { name: 'Dion sweet', path: 'full aura re/Dion%20sweet-resized.png' }, { name: 'Dion terracotta', path: 'full aura re/Dion%20terracotta-resized.png' },
            { name: 'Dion watermelon', path: 'full aura re/Dion%20watermelon-resized.png' }, { name: 'Dionysian calm', path: 'full aura re/Dionysian%20calm-resized.png' },
            { name: 'Eggy', path: 'full aura re/Eggy-resized.png' }, { name: 'Floating', path: 'full aura re/Floating-resized.png' },
            { name: 'Grey', path: 'full aura re/Grey-resized.png' }, { name: 'Joy division', path: 'full aura re/Joy%20division-resized.png' },
            { name: 'Peachy', path: 'full aura re/Peachy-resized.png' }, { name: 'Soft', path: 'full aura re/Soft-resized.png' },
            { name: 'Sweet', path: 'full aura re/Sweet-resized.png' }, { name: 'Tang', path: 'full aura re/Tang-resized.png' },
            { name: 'Thinking', path: 'full aura re/Thinking-resized.png' }, { name: 'Watermelon', path: 'full aura re/Watermelon-resized.png' },
            { name: 'Apollonian laptop', path: 'full aura re/apollonian%20laptop-resized.png' }, { name: 'Apollonian limewire', path: 'full aura re/apollonian%20limewire-resized.png' }
        ];
        const BEHIND_HEAD_TRAITS = [
            { name: 'Asuna scarf', path: 'behind head re/asuna%20scarf.png' }, { name: 'Shelter', path: 'behind head re/shelter.png' }
        ];
        const BUN_TRAITS = [
            { name: 'Bun 1', path: 'bun re/bun1.png' }, { name: 'Bun 65', path: 'bun re/bun65.png' },
            { name: 'Bun green 765', path: 'bun re/bungreen765.png' }, { name: 'Panda buns', path: 'bun re/pandabuns.png' },
            { name: 'Pink bun 65', path: 'bun re/pinkbuyn65.png' }
        ];
        const BODY_TRAITS = [
            { name: 'Apricot', path: 'body re/apricot.png' }, { name: 'Arcturian', path: 'body re/arcturian.png' },
            { name: 'Brown', path: 'body re/brown.png' }, { name: 'Brownie', path: 'body re/brownie.png' },
            { name: 'Cherry', path: 'body re/cherry.png' }, { name: 'Lemon', path: 'body re/lemon.png' },
            { name: 'Metal', path: 'body re/metal.png' }, { name: 'Orange', path: 'body re/orange.png' },
            { name: 'Pink pastel', path: 'body re/pinkpastel.png' }, { name: 'Shrek', path: 'body re/shrek.png' },
            { name: 'Tartarian', path: 'body re/tartarian.png' }, { name: 'Unicorn', path: 'body re/unicorn.png' },
            { name: 'Vanilla', path: 'body re/vanilla.png' }, { name: 'White', path: 'body re/white.png' }
        ];
        const FACE_DECORATION_TRAITS = [
            { name: 'Apt cheek', path: 'face decoration re/Apt%20cheek-resized.png' }, { name: 'Apt neck', path: 'face decoration re/Apt%20neck-resized.png' },
            { name: 'Mononoke', path: 'face decoration re/Mononoke-resized.png' }, { name: 'Naruto whiskers', path: 'face decoration re/Naruto%20whiskers-resized.png' },
            { name: 'Sasha', path: 'face decoration re/Sasha-resized.png' }, { name: 'Bandaid', path: 'face decoration re/bandaid-resized.png' },
            { name: 'Bleach 1', path: 'face decoration re/bleach1-resized.png' }, { name: 'Blood 1', path: 'face decoration re/blood1-resized.png' },
            { name: 'Blue whisker', path: 'face decoration re/bluewisker-resized.png' }, { name: 'Chrome 1', path: 'face decoration re/chrome1-resized.png' },
            { name: 'Chrome 44', path: 'face decoration re/chrome44-resized.png' }, { name: 'Dole sticker', path: 'face decoration re/dolesticker-resized.png' },
            { name: 'Eren', path: 'face decoration re/eren-resized.png' }, { name: 'Eren 2', path: 'face decoration re/eren2-resized.png' },
            { name: 'Goul', path: 'face decoration re/goul.png' }, { name: 'Love garra', path: 'face decoration re/lovegarra-resized.png' },
            { name: 'Mark 2', path: 'face decoration re/mark2-resized.png' }, { name: 'Mark 4', path: 'face decoration re/mark4-resized.png' },
            { name: 'Mark 55', path: 'face decoration re/mark55-resized.png' }, { name: 'Purple marks', path: 'face decoration re/purplemarks-resized.png' },
            { name: 'Scar 1', path: 'face decoration re/scar1-resized.png' }, { name: 'Scar 2', path: 'face decoration re/scar2-resized.png' },
            { name: 'Scar 5', path: 'face decoration re/scar5-resized.png' }, { name: 'Tattoo 1', path: 'face decoration re/tattoo1-resized.png' },
            { name: 'Tattoo 2', path: 'face decoration re/tattoo2-resized.png' }, { name: 'Tattoo 3', path: 'face decoration re/tattoo3-resized.png' },
            { name: 'Tattoo 333', path: 'face decoration re/tattoo333-resized.png' }, { name: 'Tattoo 4', path: 'face decoration re/tattoo4-resized.png' },
            { name: 'Tattoo 6', path: 'face decoration re/tattoo6-resized.png' }, { name: 'Whisker 1', path: 'face decoration re/wisker1-resized.png' }
        ];
        const BLUSH_TRAITS = [
            { name: 'Eyebrow blush', path: 'blush re/eyebrowblush.png' }, { name: 'Eyepatch', path: 'blush re/eyepatch_-resized.png' },
            { name: 'Light pink blush', path: 'blush re/lightpinkblush.png' }, { name: 'Pink blush', path: 'blush re/pinkblush.png' },
            { name: 'Red circle blush', path: 'blush re/redcircleblush.png' }
        ];
        const EYES_TRAITS = [
            { name: 'Alien 1', path: 'eyes re/Alien%281%29-resized.png' }, { name: 'Classic', path: 'eyes re/Classic-resized.png' },
            { name: 'Closed', path: 'eyes re/Closed-resized.png' }, { name: 'Crying 1', path: 'eyes re/Crying%281%29-resized.png' },
            { name: 'Crying', path: 'eyes re/Crying-resized.png' }, { name: 'Heart Eyes', path: 'eyes re/Heart%20Eyes-resized.png' },
            { name: 'Oracle', path: 'eyes re/Oracle-resized.png' }, { name: 'Sleepy', path: 'eyes re/Sleepy-resized.png' },
            { name: 'Smug', path: 'eyes re/Smug-resized.png' }, { name: 'Teary', path: 'eyes re/Teary-resized.png' },
            { name: 'Alien', path: 'eyes re/alien-resized.png' }, { name: 'Aqua 2', path: 'eyes re/aqua2-resized.png' },
            { name: 'Aqua 3', path: 'eyes re/aqua3-resized.png' }, { name: 'Aqua hearts', path: 'eyes re/aquahearts-resized.png' },
            { name: 'Blue green 2', path: 'eyes re/bluegreeen2-resized.png' }, { name: 'Blue hearts', path: 'eyes re/bluehearts-resized.png' },
            { name: 'Blue red', path: 'eyes re/bluered-resized.png' }, { name: 'Brown 2', path: 'eyes re/brown2-resized.png' },
            { name: 'Brown eyes 44', path: 'eyes re/browneyes44-resized.png' }, { name: 'Brush eyes', path: 'eyes re/brusheyes-resized.png' },
            { name: 'Chinese', path: 'eyes re/chinese-resized.png' }, { name: 'Chocolate', path: 'eyes re/chocolate-resized.png' },
            { name: 'Dark blue 1', path: 'eyes re/darkblue1-resized.png' }, { name: 'Green 2', path: 'eyes re/green2-resized.png' },
            { name: 'Green 44', path: 'eyes re/green44-resized.png' }, { name: 'Green brown', path: 'eyes re/greenbrown-resized.png' },
            { name: 'Green eyes 1', path: 'eyes re/greeneyes1-resized.png' }, { name: 'Kakashi', path: 'eyes re/kakashi-resized.png' },
            { name: 'Light brown', path: 'eyes re/lightbrown-resized.png' }, { name: 'Light green 2', path: 'eyes re/lightgreen2-resized.png' },
            { name: 'Madara', path: 'eyes re/madara-resized.png' }, { name: 'No eyes', path: 'eyes re/noeyes-resized.png' },
            { name: 'No eyes 2', path: 'eyes re/noeyes2-resized.png' }, { name: 'Obito', path: 'eyes re/obito-resized.png' },
            { name: 'One eyed', path: 'eyes re/oneeyed-resized.png' }, { name: 'Pink eyed', path: 'eyes re/pinkeyed-resized.png' },
            { name: 'Pink hearts 2', path: 'eyes re/pinkhearts2-resized.png' }, { name: 'Purple 2', path: 'eyes re/purple2-resized.png' },
            { name: 'Rainbow 2', path: 'eyes re/rainbow2-resized.png' }, { name: 'Red eyes', path: 'eyes re/redeyes-resized.png' },
            { name: 'Retart', path: 'eyes re/retart-resized.png' }, { name: 'Rinnegan', path: 'eyes re/rinnegan-resized.png' },
            { name: 'Sasuke', path: 'eyes re/sasuke-resized.png' }, { name: 'Solar', path: 'eyes re/solar-resized.png' },
            { name: 'Star eyes', path: 'eyes re/stareyes-resized.png' }, { name: 'Unicorn', path: 'eyes re/unicorn-resized.png' },
            { name: 'UwU', path: 'eyes re/uwu-resized.png' }, { name: 'Yellow green', path: 'eyes re/yellowgreen-resized.png' },
            { name: 'Yellow pink 1', path: 'eyes re/yellowpink1-resized.png' }
        ];
        const GLASSES_TRAITS = [
            { name: 'Cobain aptos', path: 'glasses re/Cobain%20aptos-resized.png' }, { name: 'Eyes Glasses Round', path: 'glasses re/Eyes-Glasses%20Round-resized.png' },
            { name: 'Eyes Glasses Orange Harajuku', path: 'glasses re/Eyes-Glasses-Orange-Harajuku-resized.png' }, { name: 'Glasses Prescription Frames', path: 'glasses re/Glasses-Perscription-Frames-resized.png' },
            { name: 'Larry Glasses', path: 'glasses re/Larry%20Glasses-resized.png' }, { name: 'Rize', path: 'glasses re/Rize-resized.png' },
            { name: 'White cobain aptos', path: 'glasses re/White%20cobain%20aptos-resized.png' }, { name: 'YY Glasses', path: 'glasses re/YY%20Glasses-resized.png' }
        ];
        const NECKLACE_TRAITS = [
            { name: 'Apt globe', path: 'necklace re/Apt%20globe-resized.png' }, { name: 'Bear', path: 'necklace re/Bear-resized.png' },
            { name: 'Cash', path: 'necklace re/Cash-resized.png' }, { name: 'Cherry', path: 'necklace re/Cherry-resized.png' },
            { name: 'Cross', path: 'necklace re/Cross-resized.png' }, { name: 'Diamond', path: 'necklace re/Diamond-resized.png' },
            { name: 'Flower of life', path: 'necklace re/Flower%20of%20life-resized.png' }, { name: 'Kitty', path: 'necklace re/Kitty-resized.png' },
            { name: 'Misa', path: 'necklace re/Misa-resized.png' }, { name: 'Naruto', path: 'necklace re/Naruto-resized.png' },
            { name: 'Neck Evil eye', path: 'necklace re/Neck-Evil-eye-resized.png' }, { name: 'Orb', path: 'necklace re/Orb-resized.png' },
            { name: 'Phone', path: 'necklace re/Phone-resized.png' }, { name: 'Star', path: 'necklace re/Star-resized.png' },
            { name: 'Sword', path: 'necklace re/Sword-resized.png' }, { name: 'Beetle', path: 'necklace re/beetle.png' },
            { name: 'Cheese necklace', path: 'necklace re/cheese%20necklace.png' }, { name: 'Dororo', path: 'necklace re/dororo-resized.png' }
        ];
        const CLOTHING_TRAITS = [
            { name: 'Anteiku uniform', path: 'clothing re/Anteiku%20uniform.png' }, { name: 'Anya dress', path: 'clothing re/Anya%20dress.png' },
            { name: 'Aptos White Shirt', path: 'clothing re/Aptos%20White%20Shirt-resized.png' }, { name: 'Avery sweater', path: 'clothing re/Avery%20sweater.png' },
            { name: 'Buzz', path: 'clothing re/Buzz-resized.png' }, { name: 'Dolores', path: 'clothing re/Dolores.png' },
            { name: 'Food Not Pharma short sleeve', path: 'clothing re/Food%20Not%20Pharma%20-%20short%20sleeve-resized.png' }, { name: 'Mape hoodie', path: 'clothing re/Mape%20hoodie.png' },
            { name: 'Random Black Robes', path: 'clothing re/Random%20Black%20Robes-resized.png' }, { name: 'Senna', path: 'clothing re/Senna.png' },
            { name: 'UA uniform', path: 'clothing re/UA%20uniform.png' }, { name: 'White dress', path: 'clothing re/White%20dress.png' },
            { name: 'Aqua', path: 'clothing re/aqua-resized.png' }, { name: 'Autism shirt', path: 'clothing re/autismshirt-resized.png' },
            { name: 'Black princess 1', path: 'clothing re/blackprincess1-resized.png' }, { name: 'Black shirt 1', path: 'clothing re/blackshirt1-resized.png' },
            { name: 'Blazer', path: 'clothing re/blazer.png' }, { name: 'Bleach uniform', path: 'clothing re/bleach%20uniform.png' },
            { name: 'Bosozuku', path: 'clothing re/bosozuku.png' }, { name: 'Corbin', path: 'clothing re/corbin-resized.png' },
            { name: 'Cortana', path: 'clothing re/cortana-resized.png' }, { name: 'Covid', path: 'clothing re/covid-resized.png' },
            { name: 'Evangalion', path: 'clothing re/evangalion-resized.png' }, { name: 'Garagura', path: 'clothing re/garagura-resized.png' },
            { name: 'Goth lolita', path: 'clothing re/goth%20lolita.png' }, { name: 'Green flannel', path: 'clothing re/green%20flannel.png' },
            { name: 'Griffith', path: 'clothing re/griffith.png' }, { name: 'Hammer shirt', path: 'clothing re/hammershirt-resized.png' },
            { name: 'Hikki tee', path: 'clothing re/hikki%20tee.png' }, { name: 'Judge Judy', path: 'clothing re/judgejudy-resized.png' },
            { name: 'Miad 1', path: 'clothing re/miad1-resized.png' }, { name: 'Princess 1', path: 'clothing re/princess1-resized.png' },
            { name: 'Princess pink 5', path: 'clothing re/princesspink5-resized.png' }, { name: 'Rocket 1', path: 'clothing re/rocket1-resized.png' },
            { name: 'Sailor', path: 'clothing re/sailor-resized.png' }, { name: 'Sorayama', path: 'clothing re/sorayama.png' },
            { name: 'Sweater', path: 'clothing re/sweater.png' }, { name: 'Type A jacket', path: 'clothing re/typeajacket-resized.png' },
            { name: 'Ukraine', path: 'clothing re/ukraine-resized.png' }, { name: 'Vaccine', path: 'clothing re/vaccine-resized.png' },
            { name: 'Violet Evergarden', path: 'clothing re/violet%20evrgarden.png' }, { name: 'White shirt 11', path: 'clothing re/whiteshirt11-resized.png' },
            { name: 'White shirt 5', path: 'clothing re/whiteshirt5-resized.png' }, { name: 'White tank', path: 'clothing re/whitetank-resized.png' },
            { name: 'White tank 2', path: 'clothing re/whitetank2-resized.png' }, { name: 'White tank 3', path: 'clothing re/whitetank3-resized.png' },
            { name: 'Yeezy 1', path: 'clothing re/yeezy1-resized.png' }
        ];
        const PIN_TRAITS = [
            { name: 'Aptos pin', path: 'pin re/Aptos%20pin-resized.png' }, { name: 'Holopin', path: 'pin re/holopin-resized.png' }
        ];
        const HAIR_TRAITS = [
            { name: 'Aqua blue 1', path: 'hair re/aquablue1-resized.png' }, { name: 'Auburn', path: 'hair re/auburn-resized.png' },
            { name: 'Auburn 2233', path: 'hair re/auburn2233-resized.png' }, { name: 'Bang pink', path: 'hair re/bangpink-resized.png' },
            { name: 'Bang red', path: 'hair re/bangred-resized.png' }, { name: 'Bangs blue 11', path: 'hair re/bangsblue11-resized.png' },
            { name: 'Black 65', path: 'hair re/black65-resized.png' }, { name: 'Black long', path: 'hair re/blacklong-resized.png' },
            { name: 'Braid black', path: 'hair re/braid%20black.png' }, { name: 'Braid chocolate', path: 'hair re/braid%20choco%20late.png' },
            { name: 'Braid corn', path: 'hair re/braid%20corn.png' }, { name: 'Braid creme', path: 'hair re/braid%20creme.png' },
            { name: 'Braid green', path: 'hair re/braid%20green.png' }, { name: 'Braid mold', path: 'hair re/braid%20mold.png' },
            { name: 'Braid pink', path: 'hair re/braid%20pink.png' }, { name: 'Braid purple', path: 'hair re/braid%20purple.png' },
            { name: 'Braid teal', path: 'hair re/braid%20teal.png' }, { name: 'Braid white', path: 'hair re/braid%20white.png' },
            { name: 'Brown 55', path: 'hair re/brown55-resized.png' }, { name: 'Brown 65', path: 'hair re/brown65-resized.png' },
            { name: 'Brown long', path: 'hair re/brownlong-resized.png' }, { name: 'Brown short 22', path: 'hair re/brownshort22-resized.png' },
            { name: 'Corn 33', path: 'hair re/corn33-resized.png' }, { name: 'Corn 34', path: 'hair re/corn34-resized.png' },
            { name: 'Corn 44', path: 'hair re/corn44-resized.png' }, { name: 'Cortana blue', path: 'hair re/cortanablue-resized.png' },
            { name: 'Creme 2', path: 'hair re/creme2-resized.png' }, { name: 'Dark 11', path: 'hair re/dark11-resized.png' },
            { name: 'Dark 65', path: 'hair re/dark65-resized.png' }, { name: 'Dark black 65', path: 'hair re/darkblack65-resized.png' },
            { name: 'Dark blue 65', path: 'hair re/darkblue65-resized.png' }, { name: 'Dark brown', path: 'hair re/darkbrown-resized.png' },
            { name: 'Dark dark 22', path: 'hair re/darkdark22-resized.png' }, { name: 'Dark pink 65', path: 'hair re/darkpink65-resized.png' },
            { name: 'Eto', path: 'hair re/eto-resized.png' }, { name: 'Fixed pink 1122', path: 'hair re/fixedpink1122-resized.png' },
            { name: 'Fuzzy red', path: 'hair re/fuzzyred-resized.png' }, { name: 'Gargura', path: 'hair re/gargura-resized.png' },
            { name: 'Green', path: 'hair re/green-resized.png' }, { name: 'Green 1165', path: 'hair re/green1165-resized.png' },
            { name: 'Green 4', path: 'hair re/green4-resized.png' }, { name: 'Green 5', path: 'hair re/green5-resized.png' },
            { name: 'Green bang 11', path: 'hair re/greenbang11-resized.png' }, { name: 'Green 1122', path: 'hair re/gren1122-resized.png' },
            { name: 'Grey 65', path: 'hair re/grey65-resized.png' }, { name: 'Honda', path: 'hair re/honda-resized.png' },
            { name: 'Light blue', path: 'hair re/lightblue-resized.png' }, { name: 'Light blue 22113', path: 'hair re/lightblue22113-resized.png' },
            { name: 'Light brown', path: 'hair re/lightbrown-resized.png' }, { name: 'Long black 1122', path: 'hair re/longblack1122-resized.png' },
            { name: 'Long black 1212', path: 'hair re/longblack1212-resized.png' }, { name: 'Long brown 1', path: 'hair re/longbrown1-resized.png' },
            { name: 'Medium green', path: 'hair re/mediumgreen-resized.png' }, { name: 'Mel mel', path: 'hair re/melmel-resized.png' },
            { name: 'Messy green', path: 'hair re/messygreen-resized.png' }, { name: 'Midnight 65', path: 'hair re/midnight65-resized.png' },
            { name: 'Mix red', path: 'hair re/mixred-resized.png' }, { name: 'Naruto', path: 'hair re/naruto-resized.png' },
            { name: 'Navy 55', path: 'hair re/navy55-resized.png' }, { name: 'Navy blue 11', path: 'hair re/navyblue11-resized.png' },
            { name: 'Off white', path: 'hair re/offwhite-resized.png' }, { name: 'Off white 2', path: 'hair re/offwhite2-resized.png' },
            { name: 'Off white 22', path: 'hair re/offwhite22-resized.png' }, { name: 'Off white 33', path: 'hair re/offwhite33-resized.png' },
            { name: 'Pink 22', path: 'hair re/pink22-resized.png' }, { name: 'Pink short 1212', path: 'hair re/pinkshort1212-resized.png' },
            { name: 'Purple 55', path: 'hair re/purple55-resized.png' }, { name: 'Purple 65', path: 'hair re/purple65-resized.png' },
            { name: 'Rainbow 11', path: 'hair re/rainbow11-resized.png' }, { name: 'Rainbow 3322', path: 'hair re/rainbow3322-resized.png' },
            { name: 'Red 5', path: 'hair re/red5-resized.png' }, { name: 'Red 65', path: 'hair re/red65-resized.png' },
            { name: 'Rose 65', path: 'hair re/rose65-resized.png' }, { name: 'Seto green', path: 'hair re/setogreen-resized.png' },
            { name: 'Short black', path: 'hair re/shortblack-resized.png' }, { name: 'Short black 11', path: 'hair re/shortblack11-resized.png' },
            { name: 'Short blue 11', path: 'hair re/shortblue11-resized.png' }, { name: 'Short brown 5544', path: 'hair re/shortbrown5544-resized.png' },
            { name: 'Short dark black brown', path: 'hair re/shortdarkbalckbriown-resized.png' }, { name: 'Short grey 11', path: 'hair re/shortgrey11-resized.png' },
            { name: 'Short pink', path: 'hair re/shortpink-resized.png' }, { name: 'Short purple', path: 'hair re/shortpurple-resized.png' },
            { name: 'Short red', path: 'hair re/shortred-resized.png' }, { name: 'Short white 1', path: 'hair re/shortwhite1-resized.png' },
            { name: 'Short yellow 1', path: 'hair re/shortyello1-resized.png' }, { name: 'Short yellow 112233', path: 'hair re/shortyello112233-resized.png' },
            { name: 'Silver 65', path: 'hair re/silver65-resized.png' }, { name: 'Teal 65', path: 'hair re/teal65-resized.png' },
            { name: 'White', path: 'hair re/white-resized.png' }, { name: 'White 2', path: 'hair re/white2-resized.png' },
            { name: 'White 3', path: 'hair re/white3-resized.png' }, { name: 'White 55', path: 'hair re/white55-resized.png' },
            { name: 'White 65', path: 'hair re/white65-resized.png' }, { name: 'Yellow', path: 'hair re/yellow-resized.png' },
            { name: 'Yellow 112222', path: 'hair re/yellow112222-resized.png' }, { name: 'Yellow 2', path: 'hair re/yellow2-resized.png' },
            { name: 'Yellow 2233', path: 'hair re/yellow2233-resized.png' }, { name: 'Yellow 65', path: 'hair re/yellow65-resized.png' }
        ];
        const EARRING_TRAITS = [
            { name: 'Aptos cross', path: 'earring re/aptoscross.png' }, { name: 'Aptos dangle', path: 'earring re/aptosdangle.png' },
            { name: 'Aptos stud', path: 'earring re/aptosstud.png' }, { name: 'Bow', path: 'earring re/bow.png' },
            { name: 'Cross emoji', path: 'earring re/crossemoji.png' }, { name: 'Floppy', path: 'earring re/floppy.png' },
            { name: 'Headphones', path: 'earring re/headphones.png' }, { name: 'Mouse', path: 'earring re/mouse.png' },
            { name: 'Pancakes', path: 'earring re/pancakes.png' }
        ];
        const HEAD_TRAITS = [
            { name: 'Cake Hat', path: 'head re/Cake%20Hat.png' }, { name: 'FEBB28EB', path: 'head re/FEBB28EB-9421-4E7B-9ECA-66CBF3A7A4F8-resized.png' },
            { name: 'MWO', path: 'head re/MWO-resized.png' }, { name: 'MWO2', path: 'head re/MWO2-resized.png' },
            { name: 'Anya', path: 'head re/anya-resized.png' }, { name: 'Apple head', path: 'head re/applehead-resized.png' },
            { name: 'Aptos pin', path: 'head re/aptospin-resized.png' }, { name: 'Ashibie', path: 'head re/ashibie-resized.png' },
            { name: 'Aura hat', path: 'head re/aurahat-resized.png' }, { name: 'Bass pro hat', path: 'head re/bassprohat-resized.png' },
            { name: 'Brain zone', path: 'head re/brainzone-resized.png' }, { name: 'Cat ears', path: 'head re/catears-resized.png' },
            { name: 'Crown 1', path: 'head re/crown1-resized.png' }, { name: 'Dole sticker', path: 'head re/dolesticker-resized.png' },
            { name: 'Fujimoto', path: 'head re/fujimoto-resized.png' }, { name: 'Hair tibbet', path: 'head re/hairtibbet-resized.png' },
            { name: 'Haku', path: 'head re/haku-resized.png' }, { name: 'Hinami', path: 'head re/hinami-resized.png' },
            { name: 'Lettuce', path: 'head re/lettuce-resized.png' }, { name: 'McGriddle', path: 'head re/mcgriddle-resized.png' },
            { name: 'One eye', path: 'head re/oneeye-resized.png' }, { name: 'Pink hair row', path: 'head re/pinkhairrow-resized.png' },
            { name: 'Pink hat 11', path: 'head re/pinkhat11-resized.png' }, { name: 'Pink horns', path: 'head re/pinkhorns-resized.png' },
            { name: 'Pink teeth', path: 'head re/pinkteeth-resized.png' }, { name: 'Plant head', path: 'head re/planthead-resized.png' },
            { name: 'Purple bar', path: 'head re/purplebar-resized.png' }, { name: 'Radiation', path: 'head re/radiation-resized.png' },
            { name: 'Retart puter', path: 'head re/retart%20puter.png' }, { name: 'Ribbons', path: 'head re/ribbons-resized.png' },
            { name: 'Shark', path: 'head re/shark-resized.png' }, { name: 'Sharky', path: 'head re/sharky.png' },
            { name: 'Slime', path: 'head re/slime-resized.png' }, { name: 'Strawberry', path: 'head re/strawberry-resized.png' },
            { name: 'Tech horns', path: 'head re/techhorns-resized.png' }, { name: 'Toast', path: 'head re/toast-resized.png' },
            { name: 'Toothless', path: 'head re/toothless-resized.png' }, { name: 'Yahikko', path: 'head re/yahikko-resized.png' }
        ];
        const EYEBROWS_TRAITS = [
            { name: 'Albanian', path: 'eyebrows re/albanian-resized.png' }, { name: 'Alien', path: 'eyebrows re/alien-resized.png' },
            { name: 'American', path: 'eyebrows re/american-resized.png' }, { name: 'Asian', path: 'eyebrows re/asian-resized.png' },
            { name: 'Indian', path: 'eyebrows re/indian-resized.png' }, { name: 'Jewish', path: 'eyebrows re/jewish-resized.png' },
            { name: 'Swordfish', path: 'eyebrows re/swordfish-resized.png' }
        ];
        const MOUTH_TRAITS = [
            { name: '3', path: 'mouth re/3-resized.png' }, { name: 'Cat', path: 'mouth re/Cat-resized.png' },
            { name: 'Cigar', path: 'mouth re/Cigar-resized.png' }, { name: 'Crooked', path: 'mouth re/Crooked-resized.png' },
            { name: 'Elated', path: 'mouth re/Elated-resized.png' }, { name: 'Fang', path: 'mouth re/Fang-resized.png' },
            { name: 'Flat', path: 'mouth re/Flat-resized.png' }, { name: 'Griffith', path: 'mouth re/Griffith-resized.png' },
            { name: 'Half frown', path: 'mouth re/Half%20frown-resized.png' }, { name: 'Hm', path: 'mouth re/Hm-resized.png' },
            { name: 'Pout', path: 'mouth re/Pout-resized.png' }, { name: 'Smile', path: 'mouth re/Smile-resized.png' },
            { name: 'Smile B', path: 'mouth re/SmileB-resized.png' }, { name: 'Smile C', path: 'mouth re/SmileC-resized.png' },
            { name: 'Smug', path: 'mouth re/Smug-resized.png' }, { name: 'Teeth', path: 'mouth re/Teeth-resized.png' },
            { name: 'Tohru', path: 'mouth re/Tohru-resized.png' }, { name: 'Vamp', path: 'mouth re/Vamp-resized.png' }
        ];
        const HALF_AURA_TRAITS = [
            { name: 'Dark blue 22', path: 'Half aura/darkblue22.PNG' }, { name: 'Distorted 11', path: 'Half aura/distorted11.PNG' },
            { name: 'Green wave', path: 'Half aura/greenwave.PNG' }, { name: 'Ocean blue 22', path: 'Half aura/oceanblue22.PNG' },
            { name: 'Oil slick', path: 'Half aura/oilslick.PNG' }, { name: 'Rainbow 1', path: 'Half aura/rainbow1.PNG' },
            { name: 'White heart', path: 'Half aura/whiteheart.PNG' }
        ];
        const ITEM_TRAITS = [
            { name: 'Aqua keyblade', path: 'item re/Aqua%20keyblade-resized.png' }, { name: 'Bankai', path: 'item re/Bankai-resized.png' },
            { name: 'Cartman', path: 'item re/Cartman-resized.png' }, { name: 'Cereal', path: 'item re/Cereal-resized.png' },
            { name: 'Cheeseborgor', path: 'item re/Cheeseborgor-resized.png' }, { name: 'Cig', path: 'item re/Cig-resized.png' },
            { name: 'Death note', path: 'item re/Death%20note-resized.png' }, { name: 'Final fantasy', path: 'item re/Final%20fantasy-resized.png' },
            { name: 'Glep', path: 'item re/Glep-resized.png' }, { name: 'Kirito', path: 'item re/Kirito-resized.png' },
            { name: 'Kittykaki', path: 'item re/Kittykaki-resized.png' }, { name: 'Leek', path: 'item re/Leek-resized.png' },
            { name: 'Light sword', path: 'item re/light-resized.png' }, { name: 'Lily', path: 'item re/Lily-resized.png' },
            { name: 'Milady Fumo', path: 'item re/Milady%20Fumo-resized.png' }, { name: 'OC hammer', path: 'item re/OC%20hammer-resized.png' },
            { name: 'Pak-9', path: 'item re/Pak-9-resized.png' }, { name: 'Remilia', path: 'item re/remilia-resized.png' },
            { name: 'Shishi', path: 'item re/Shishi-resized.png' }, { name: 'Spacekitty', path: 'item re/Spacekitty-resized.png' },
            { name: 'Spoon', path: 'item re/spoon-resized.png' }, { name: 'Ilawbu', path: 'item re/ilaw-resized.png' }
        ];
        const OVERLAY_TRAITS = [
            { name: 'Bees', path: 'overlay re/Bees-resized.png' }, { name: 'Jesus Fish', path: 'overlay re/jesus-resized.png' },
            { name: 'Sparkles', path: 'overlay re/sparkles-resized.png' },
        ];


        // State
        const state = {
            fontSize: 50,
            glowEnabled: false,
            traitLists: {},
            currentIndices: Object.fromEntries(CATEGORIES.map(category => [category, 0])),
            layerVisibility: Object.fromEntries(CATEGORIES.map(category => [category, true])),
            imageCache: new Map()
        };

        // DOM Elements
        const elements = {
            topTextInput: document.getElementById('top-text'),
            bottomTextInput: document.getElementById('bottom-text'),
            fontSizeSlider: document.getElementById('font-size-slider'),
            fontSizeLabel: document.getElementById('font-size-label'),
            glowCheckbox: document.getElementById('glow-checkbox'),
            canvas: document.getElementById('character-canvas')
        };

        // Canvas Setup
        elements.canvas.width = CANVAS_WIDTH;
        elements.canvas.height = CANVAS_HEIGHT;
        const ctx = elements.canvas.getContext('2d');
        logInfo(`Canvas initialized with size ${CANVAS_WIDTH}x${CANVAS_HEIGHT}`);

        // Utility Functions
        function showLoading() {
            const existing = document.querySelector('.loading');
            if (existing) existing.remove();
            const loadingText = document.createElement('div');
            loadingText.className = 'loading';
            loadingText.textContent = 'Loading...';
            elements.canvas.parentElement.insertBefore(loadingText, elements.canvas);
        }

        function hideLoading() {
            const loadingText = document.querySelector('.loading');
            if (loadingText) loadingText.remove();
        }
        
        function logError(message, error) {
            console.error(`[${new Date().toISOString()}] ${message}`, error?.message || error);
        }

        function logInfo(message, data = '') {
            console.log(`[${new Date().toISOString()}] ${message}`, data);
        }
        
        // Populate Trait Lists
        async function populateTraitLists() {
            const filesByCategory = {
                'bgs re': BACKGROUND_TRAITS,
                'Full aura re': FULL_AURA_TRAITS,
                'Behind head re': BEHIND_HEAD_TRAITS,
                'Bun re': BUN_TRAITS,
                'Body re': BODY_TRAITS,
                'Face decoration re': FACE_DECORATION_TRAITS,
                'Blush re': BLUSH_TRAITS,
                'Eyes re': EYES_TRAITS,
                'Glasses re': GLASSES_TRAITS,
                'Necklace re': NECKLACE_TRAITS,
                'Clothing re': CLOTHING_TRAITS, 
                'Pin re': PIN_TRAITS,
                'Hair re': HAIR_TRAITS,        
                'Earring re': EARRING_TRAITS,
                'Head re': HEAD_TRAITS,
                'Eyebrows re': EYEBROWS_TRAITS,
                'Mouth re': MOUTH_TRAITS,
                'Half aura': HALF_AURA_TRAITS,
                'Item re': ITEM_TRAITS,
                'Overlay re': OVERLAY_TRAITS
            };

            CATEGORIES.forEach(category => {
                const files = filesByCategory[category] || [];
                // Ensure files are sorted by name for consistent order
                const sortedFiles = files.sort((a, b) => a.name.localeCompare(b.name));

                if (category === 'Clothing re' || category === 'Hair re') {
                    state.traitLists[category] = [...sortedFiles];
                    if (sortedFiles.length > 0) {
                        state.currentIndices[category] = 0;
                    } else {
                        state.currentIndices[category] = -1; 
                        logError(`Layer ${category} is empty. Ensure trait arrays are populated.`);
                    }
                } else {
                    state.traitLists[category] = [{ name: 'None', path: 'none' }, ...sortedFiles];
                    state.currentIndices[category] = 0; 
                }

                logInfo(`Populated ${category} with ${state.traitLists[category].length} traits. Initial index: ${state.currentIndices[category]}`);
                
                const nameElement = document.getElementById(`${category.toLowerCase().replace(/ /g, '-')}-name`);
                if (nameElement) {
                    if (state.traitLists[category].length > 0 && state.currentIndices[category] !== -1) {
                        const initialTrait = state.traitLists[category][state.currentIndices[category]];
                        nameElement.textContent = initialTrait ? initialTrait.name : 'N/A';
                    } else {
                        nameElement.textContent = 'Empty'; // Or 'N/A' if preferred for empty lists
                    }
                } else {
                    logError(`Element not found for trait name: ${category.toLowerCase().replace(/ /g, '-')}-name`);
                }
            });
            logInfo('Trait lists populated and initial names set.');
        }


        // Image Loading with Retry (Original function)
        async function loadImage(url, traitName, retryCount = 0, gatewayIndex = 0) {
            if (state.imageCache.has(url)) {
                logInfo(`Cache hit for ${traitName}: ${url}`);
                return state.imageCache.get(url);
            }

            if (gatewayIndex >= GATEWAYS.length) {
                throw new Error(`All gateways failed for ${traitName}`);
            }

            const gatewayUrl = `${GATEWAYS[gatewayIndex]}${FOLDER_CID}/${url}`;
            logInfo(`Attempting to load ${traitName} (retry ${retryCount}/${MAX_RETRIES}, gateway ${gatewayIndex + 1}/${GATEWAYS.length}): ${gatewayUrl}`);

            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.onload = () => {
                    state.imageCache.set(url, img);
                    logInfo(`Loaded and cached ${traitName}: ${gatewayUrl}`);
                    resolve(img);
                };
                img.onerror = async () => {
                    logError(`Failed to load ${traitName}: ${gatewayUrl}`);
                    if (retryCount < MAX_RETRIES) {
                        try {
                            const retryImg = await loadImage(url, traitName, retryCount + 1, gatewayIndex);
                            resolve(retryImg);
                        } catch (e) { reject(e); }
                    } else if (gatewayIndex < GATEWAYS.length - 1) {
                        try {
                            const nextGatewayImg = await loadImage(url, traitName, 0, gatewayIndex + 1);
                            resolve(nextGatewayImg);
                        } catch (e) { reject(e); }
                    } else {
                        reject(new Error(`Failed to load ${traitName} after ${MAX_RETRIES} retries across all gateways`));
                    }
                };
                img.src = gatewayUrl;
            });
        }

        // Render Text (Original function)
        function renderText() {
            const topText = elements.topTextInput.value.trim();
            const bottomText = elements.bottomTextInput.value.trim();
            if (!topText && !bottomText) return;

            ctx.font = `bold ${state.fontSize}px Impact`;
            ctx.fillStyle = 'white';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 4; 
            ctx.textAlign = 'center';

            if (state.glowEnabled) {
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#0000FF'; 
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
            }

            const topTextY = state.fontSize + 20; 
            const bottomTextY = CANVAS_HEIGHT - 20; 

            if (topText) {
                logInfo('Drawing top text', topText);
                ctx.strokeText(topText, CANVAS_WIDTH / 2, topTextY); 
                ctx.fillText(topText, CANVAS_WIDTH / 2, topTextY);
            }
            if (bottomText) {
                logInfo('Drawing bottom text', bottomText);
                ctx.strokeText(bottomText, CANVAS_WIDTH / 2, bottomTextY); 
                ctx.fillText(bottomText, CANVAS_WIDTH / 2, bottomTextY);
            }
            ctx.shadowBlur = 0;
            ctx.shadowColor = 'transparent';
        }

        // Update Canvas
        async function updateCharacterImage() {
            logInfo('Updating character image');
            if (!Object.keys(state.traitLists).length || CATEGORIES.some(cat => !state.traitLists[cat])) {
                logError('Trait lists not fully populated yet.');
            }
            
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            showLoading();

            async function loadImageLayer(index) {
                if (index >= DRAWING_ORDER.length) {
                    renderText(); 
                    hideLoading();
                    logInfo('Canvas update complete');
                    return;
                }

                const { layer } = DRAWING_ORDER[index];

                // Clothing layer visibility is always true as it has no UI toggle.
                if (!state.layerVisibility[layer] && layer !== 'Clothing re') { 
                    logInfo(`Layer ${layer} is hidden, skipping.`);
                    await loadImageLayer(index + 1); 
                    return;
                }

                const traitIndex = state.currentIndices[layer];
                const traitListForLayer = state.traitLists[layer];

                if (!traitListForLayer || traitListForLayer.length === 0) {
                    logError(`No trait list found or empty for layer: ${layer}`);
                    await loadImageLayer(index + 1);
                    return;
                }
                
                if (traitIndex === -1) { // Handles empty Clothing/Hair lists
                    logInfo(`Layer ${layer} has no valid selection (index is -1), skipping image load.`);
                    await loadImageLayer(index + 1);
                    return;
                }
                
                const trait = traitListForLayer[traitIndex];
                if (!trait) {
                    logError(`No trait found for ${layer} at index ${traitIndex}`);
                    await loadImageLayer(index + 1);
                    return;
                }

                // Check for 'none' path. This should only apply to layers that still have a "None" option.
                // Clothing and Hair layers should not have a 'none' path if logic is correct.
                if (trait.path === 'none') {
                    logInfo(`Layer ${layer} is set to 'None', skipping image load.`);
                    await loadImageLayer(index + 1);
                    return;
                }

                logInfo(`Loading image for ${layer}: ${trait.name} from ${trait.path}`);

                try {
                    const img = await loadImage(trait.path, trait.name);
                    ctx.drawImage(img, 0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                    logInfo(`Rendered ${trait.name} (layer: ${layer})`);
                } catch (error) {
                    logError(`Failed to load or draw image for ${layer}: ${trait.name}`, error);
                }
                await loadImageLayer(index + 1); 
            }

            try {
                await loadImageLayer(0);
            } catch (error) {
                logError('Overall canvas update failed during layer processing', error);
                hideLoading(); 
                renderText(); 
            }
        }

        // Event Handlers
        window.updateFontSize = value => {
            state.fontSize = parseInt(value);
            elements.fontSizeLabel.textContent = `Font Size: ${state.fontSize}px`;
            logInfo(`Font size updated to ${state.fontSize}px`);
            updateCharacterImage();
        };

        window.updateGlow = checked => {
            state.glowEnabled = checked;
            logInfo(`Glow enabled: ${state.glowEnabled}`);
            updateCharacterImage();
        };

        window.changeTrait = (layer, direction) => {
            if (!state.traitLists[layer]) {
                logError(`Trait list for layer ${layer} not found.`);
                return;
            }
            const listLength = state.traitLists[layer].length;
            if (!listLength) { 
                logError(`No traits available for ${layer}`);
                return;
            }

            let newIndex = state.currentIndices[layer] + direction;
            newIndex = (newIndex % listLength + listLength) % listLength; 

            state.currentIndices[layer] = newIndex;
            const trait = state.traitLists[layer][newIndex];
            logInfo(`Changed ${layer} to ${trait.name} (index ${newIndex})`);
            
            const nameElement = document.getElementById(`${layer.toLowerCase().replace(/ /g, '-')}-name`);
            if (nameElement) {
                 nameElement.textContent = trait.name;
            } else {
                logError(`Element ID not found for trait name display: ${layer.toLowerCase().replace(/ /g, '-')}-name`);
            }
            updateCharacterImage();
        };

        window.toggleLayerVisibility = (layerName, buttonElement) => {
    if (typeof state.layerVisibility[layerName] === 'undefined') {
        logError(`Visibility state for layer ${layerName} is undefined.`);
        state.layerVisibility[layerName] = true; 
    }
    state.layerVisibility[layerName] = !state.layerVisibility[layerName];
    logInfo(`Toggled visibility for ${layerName} to ${state.layerVisibility[layerName]}`);
    
    buttonElement.classList.toggle('hidden-layer', !state.layerVisibility[layerName]);
    buttonElement.textContent = state.layerVisibility[layerName] ? 'üëÅÔ∏è' : 'üö´';
    updateCharacterImage(); 
};

        window.randomizeTraits = () => {
            logInfo('Randomizing traits');
            // Check if all categories have trait lists and they are not empty
            const allEffectivelyPopulated = CATEGORIES.every(category => {
                const traitList = state.traitLists[category];
                return traitList && traitList.length > 0;
            });

            if (!allEffectivelyPopulated) {
                logError('Randomization failed: Some trait lists are effectively empty or not populated.');
                const statusDiv = document.getElementById('status-message'); 
                if (statusDiv) statusDiv.textContent = 'Cannot randomize: Assets loading or some categories are empty. Try again soon.';
                else console.warn('Status message element not found for user feedback.');
                return;
            }

            CATEGORIES.forEach(layer => {
                const listLength = state.traitLists[layer].length;
                // This check is now more robust due to the allEffectivelyPopulated check above.
                // if (listLength === 0) { 
                //     logInfo(`Layer ${layer} has no traits to randomize, skipping.`);
                //     return;
                // }
                const randomIndex = Math.floor(Math.random() * listLength);
                state.currentIndices[layer] = randomIndex;
                const trait = state.traitLists[layer][randomIndex];
                logInfo(`Randomized ${layer} to ${trait.name} (index ${randomIndex})`);
                const nameElement = document.getElementById(`${layer.toLowerCase().replace(/ /g, '-')}-name`);
                 if (nameElement) {
                    nameElement.textContent = trait.name;
                }
            });
            updateCharacterImage();
        };

        // Initialize
        async function initialize() {
    logInfo('Initializing character generator');
    showLoading(); 
    try {
        await populateTraitLists(); 
        logInfo('Trait lists populated');
        randomizeTraits(); // Call randomizeTraits to set random traits on load
        document.querySelectorAll('.eye-toggle').forEach(button => {
            const layerNavElement = button.nextElementSibling;
            if (layerNavElement && layerNavElement.classList.contains('trait-nav')) {
                const layerName = layerNavElement.getAttribute('data-layer'); 
                if (layerName && state.layerVisibility[layerName]) {
                    button.classList.remove('hidden-layer');
                } else if (layerName) {
                    button.classList.add('hidden-layer');
                }
            }
        });
        await updateCharacterImage(); 
        logInfo('Initialization complete');
    } catch (error) {
        logError('Initialization failed', error);
    } finally {
        // hideLoading(); // Handled by updateCharacterImage or error block
    }
}

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
