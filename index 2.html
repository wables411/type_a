<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>𝙈𝙄𝙇𝘼𝘿𝙔 𝙏𝙔𝙋𝙀 𝘼</title>
    <link rel="stylesheet" href="style.css">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <!-- Aptos Wallet Adapter Scripts -->
    <script defer src="https://unpkg.com/@aptos-labs/wallet-adapter-core@3.5.0/dist/index.global.js"></script>
    <script defer src="https://unpkg.com/petra-plugin-wallet-adapter@0.5.0/dist/index.global.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header GIF -->
        <img src="assets/typeaheader.gif" alt="Header GIF" class="header-gif">

        <!-- Title with Image -->
            <img src="assets/miladytypea_logo.png" alt="Milady Type A Logo" class="glitter-text">

        <!-- Description Box -->
        <div class="box description">
            <p>𝙼𝚒𝚕𝚊𝚍𝚢 : 𝚃𝚢𝚙𝚎 𝙰 𝚒𝚜 𝚊 𝚌𝚘𝚕𝚕𝚎𝚌𝚝𝚒𝚘𝚗 𝚘𝚏 𝟺,𝟺𝟺𝟺 𝚐𝚎𝚗𝚎𝚛𝚊𝚝𝚒𝚟𝚎 𝚙𝚏𝚙𝙽𝙵𝚃'𝚜 𝚒𝚗 𝚊 𝚗𝚎𝚘𝚌𝚑𝚒𝚋𝚒 𝚊𝚎𝚜𝚝𝚑𝚎𝚝𝚒𝚌 𝚒𝚗𝚜𝚙𝚒𝚛𝚎𝚍 𝚋𝚢 𝙼𝚒𝚕𝚊𝚍𝚢 𝙼𝚊𝚔𝚎𝚛 𝙽𝙵𝚃, 𝚁𝚎𝚖𝚒𝚕𝚒𝚊 𝙲𝚘𝚛𝚙𝚘𝚛𝚊𝚝𝚒𝚘𝚗, 𝚊𝚜 𝚠𝚎𝚕𝚕 𝚊𝚜 𝚒𝚝𝚜 𝚖𝚊𝚗𝚢 𝚍𝚎𝚛𝚒𝚟𝚊𝚝𝚒𝚟𝚎𝚜. 𝚃𝚢𝚙𝚎 𝙰 𝚛𝚎𝚙𝚛𝚎𝚜𝚎𝚗𝚝𝚜 𝚎𝚕𝚎𝚖𝚎𝚗𝚝𝚜 𝚘𝚏 𝚑𝚒𝚐𝚑-𝚙𝚎𝚛𝚏𝚘𝚛𝚖𝚊𝚗𝚌𝚎 𝚊𝚝𝚝𝚛𝚒𝚋𝚞𝚝𝚎𝚍 𝚋𝚢 𝚝𝚑𝚎 𝚌𝚘𝚖𝚖𝚞𝚗𝚒𝚝𝚢 𝚊𝚗𝚍 𝚌𝚞𝚕𝚝𝚞𝚛𝚊𝚕 𝚒𝚌𝚘𝚗𝚜 𝚘𝚗 𝚝𝚑𝚎 𝙰𝚙𝚝𝚘𝚜 𝚗𝚎𝚝𝚠𝚘𝚛𝚔.</p>
        </div>

        <!-- Minting Box -->
        <div class="box minting">
            <p>𝙱𝚛𝚒𝚍𝚐𝚒𝚗𝚐 𝙼𝚒𝚕𝚊𝚍𝚢 𝚝𝚘 𝙰𝚙𝚝𝚘𝚜 𝚝𝚑𝚒𝚜 𝚜𝚙𝚛𝚒𝚗𝚐 🌐🤍🌷</p>
            <img src="assets/initiald.gif" alt="Car GIF" class="small-gif">
            <p>𝟺,𝟺𝟺𝟺 𝚜𝚞𝚙𝚙𝚕𝚢 🌐🤍 𝟷,𝟺𝟺𝟺 𝚏𝚛𝚎𝚎 𝚖𝚒𝚗𝚝𝚜</p>
            <p>𝚙𝚞𝚋𝚕𝚒𝚌 𝚖𝚒𝚗𝚝 🌐🤍 𝟷𝟷 𝙰𝙿𝚃𝙾𝚂</p>
            <p>𝟷,𝟶𝟶𝟶 𝚍𝚒𝚜𝚌𝚘𝚞𝚗𝚝𝚎𝚍 𝚖𝚒𝚗𝚝𝚜 🌐🤍 𝟻 𝙰𝙿𝚃𝙾𝚂</p>
            <p>𝙒𝙃𝙄𝙏𝙀𝙇𝙄𝙎𝙏</p>
            <p><a href="https://miladymaker.net/" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝑀𝒾𝓁𝒶𝒹𝓎 𝑀𝒶𝓀𝑒𝓇</a></p>
            <p><a href="https://remilio.org/" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝑅𝑒𝒹𝒶𝒸𝓉𝑒𝒹 𝑅𝑒𝓂𝒾𝓁𝒾𝑜 𝐵𝒶𝒷𝒾𝑒𝓈</a></p>
            <p><a href="https://radbro.xyz/" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝑅𝒶𝒹𝒷𝓇𝑜</a></p>
            <p><a href="https://radbro.xyz/" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝑅𝒶𝒹𝒸𝒶𝓉</a></p>
            <p><a href="https://www.scatter.art/kawamii" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒦𝒶𝓌𝒶𝓂𝒾𝒾 𝒯𝑒𝑒𝓃𝓈</a></p>
            <p><a href="https://www.tensor.trade/trade/midladys_fumogeddon" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝑀𝒾𝒹𝓁𝒶𝒹𝓎</a></p>
            <p><a href="https://www.scatter.art/collection/pixelady-maker" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒫𝒾𝓍𝑒𝓁𝒶𝒹𝓎 𝑀𝒶𝓀𝑒𝓇</a></p>
            <p><a href="https://magiceden.us/collections/base/0xee7d1b184be8185adc7052635329152a4d0cdefa" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒦𝑒𝓂𝑜𝓃𝑜𝓀𝒶𝓀𝒾</a></p>
            <p><a href="https://x1333.net/" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝟣𝟥𝟥𝟥 𝒸𝑜</a></p>
            <p><a href="https://magiceden.us/marketplace/uwu_banners" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒰𝓌𝒰 𝐵𝒶𝓃𝓃𝑒𝓇𝓈</a></p>
            <p><a href="https://www.scatter.art/twilight-rooms" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒯𝓌𝒾𝑔𝒽𝓁𝒾𝑔𝒽𝓉 𝑅𝑜𝑜𝓂𝓈</a></p>
            <p><a href="https://opensea.io/collection/7w1l1gh7z0n3-vol-1-meowmaows" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒯𝓌𝒾𝑔𝒽𝓁𝒾𝑔𝒽𝓉 𝒵𝑜𝓃𝑒</a></p>
            <p><a href="https://aptosfoundation.org/" target="_blank" rel="noopener noreferrer" class="whitelist-link">𝒜𝓅𝓉𝑜𝓈 𝒲𝒽𝒶𝓁𝑒𝓈</a></p>
            <!-- Mint Proceeds Section -->
            <p>𝙈𝙄𝙉𝙏 𝙋𝙍𝙊𝘾𝙀𝙀𝘿𝙎</p>
            <p>𝟸𝟶% 𝚘𝚏 𝚖𝚒𝚗𝚝 𝚙𝚛𝚘𝚌𝚎𝚎𝚍𝚜 𝚍𝚒𝚛𝚎𝚌𝚝𝚎𝚍 𝚝𝚘𝚠𝚊𝚛𝚍𝚜 𝚛𝚎𝚖𝚒𝚕𝚒𝚊 𝚝𝚛𝚎𝚊𝚜𝚞𝚛𝚢</p>
            <p>𝟻% 𝚍𝚒𝚛𝚎𝚌𝚝𝚎𝚍 𝚝𝚘𝚠𝚊𝚛𝚍𝚜 𝚎𝚖𝚘𝚓𝚒𝚌𝚘𝚒𝚗 𝚊𝚜𝚜𝚎𝚝𝚜 𝚘𝚗 𝙰𝚙𝚝𝚘𝚜! 🌐🐝🧀</p>
            <p>𝟻% 𝚊𝚕𝚕𝚘𝚌𝚊𝚝𝚎𝚍 𝚏𝚘𝚛 𝚐𝚒𝚟𝚎𝚊𝚠𝚊𝚢𝚜/𝚌𝚘𝚗𝚝𝚎𝚜𝚝𝚜 𝚠𝚒𝚝𝚑𝚒𝚗 𝚝𝚑𝚎 𝚌𝚘𝚖𝚖𝚞𝚗𝚒𝚝𝚢</p>
        </div>

        <!-- MP3 Player -->
        <div class="mp3-player">
            <div class="winamp-display">
                <div class="song-title" id="song-title">Loading...</div>
                <div class="display-bottom">
                    <div class="equalizer" id="equalizer"></div>
                    <div class="song-timer" id="song-timer">0:00 / 0:00</div>
                </div>
            </div>
            <div class="winamp-controls">
                <button onclick="previousSong()" class="winamp-button back-button">Back</button>
                <button onclick="togglePlayPause()" class="winamp-button play-pause-button" id="play-pause-button">Play</button>
                <button onclick="shuffleSong()" class="winamp-button next-button">Next</button>
            </div>
            <audio id="player"></audio>
        </div>

        <!-- Chat Box -->
        <div class="box chat">
            <p><strong>Chat:</strong> Say hi to fellow nostalgia fans!</p>
            <textarea id="chat-log" readonly></textarea>
            <div id="wallet-status"></div>
            <div class="wallet-prompt" id="wallet-prompt">
                <button onclick="connectWallet()" class="chat-button">Connect Wallet</button>
            </div>
            <div class="chat-input" id="chat-input" style="display: none;">
                <input type="text" id="chat-message" placeholder="Type your message..." maxlength="100">
                <button onclick="sendMessage()" class="chat-button">Send</button>
            </div>
        </div>

        <!-- GIF Button -->
        <a href="https://neocities.org" target="_blank">
            <img src="https://media.giphy.com/media/26FPy3QZQqGtD0pba/giphy.gif" alt="Neocities Button" class="gif-button">
        </a>
    </div>

    <!-- MP3 Player Script -->
    <script>
        const songs = [
            "assets/lovestory.mp3",
            "assets/mononoaware.mp3",
            "assets/BITCH_I_DID-THE.RACE.mp3",
            "assets/DESTRUCTION.mp3",
            "assets/dqdvTSDlaMKx.mp3",
            "assets/exorcism.mp3",
            "assets/Heart Of Stone.mp3",
            "assets/long day.mp3",
            "assets/cloud.mp3",
            "assets/recipie for a femcel (boxxy f4g V2).mp3"
        ];
        let currentSong = 0;
        const player = document.getElementById("player");
        const songTitleDisplay = document.getElementById("song-title");
        const songTimerDisplay = document.getElementById("song-timer");
        const playPauseButton = document.getElementById("play-pause-button");
        const equalizer = document.getElementById("equalizer");

        // Web Audio API setup
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioContext.createAnalyser();
        const source = audioContext.createMediaElementSource(player);
        source.connect(analyser);
        analyser.connect(audioContext.destination);
        analyser.fftSize = 64;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        // Create equalizer bars
        const barCount = 10;
        const bars = [];
        for (let i = 0; i < barCount; i++) {
            const bar = document.createElement("div");
            bar.classList.add("eq-bar");
            equalizer.appendChild(bar);
            bars.push(bar);
        }

        // Function to format time (mm:ss)
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Update timer display
        function updateTimer() {
            const currentTime = player.currentTime;
            const duration = player.duration || 0;
            songTimerDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        }

        // Function to extract song title from file path
        function getSongTitle(filePath) {
            const fileName = filePath.split('/').pop();
            return fileName.replace('.mp3', '');
        }

        // Update song title display
        function updateSongTitle() {
            songTitleDisplay.textContent = getSongTitle(songs[currentSong]);
        }

        // Animate equalizer bars
        function animateEqualizer() {
            analyser.getByteFrequencyData(dataArray);
            for (let i = 0; i < barCount; i++) {
                const index = Math.floor((i / barCount) * bufferLength);
                const value = dataArray[index] / 255;
                bars[i].style.height = `${value * 20}px`;
            }
            requestAnimationFrame(animateEqualizer);
        }

        // Toggle play/pause with a check to avoid rapid toggling
        let isPlaying = false;
        function togglePlayPause() {
            if (audioContext.state === "suspended") {
                audioContext.resume().then(() => {
                    console.log("AudioContext resumed successfully");
                }).catch(err => {
                    console.error("Failed to resume AudioContext:", err);
                });
            }

            if (player.paused && !isPlaying) {
                isPlaying = true;
                if (!player.src || player.src !== songs[currentSong]) {
                    player.src = songs[currentSong];
                    player.load();
                }
                player.addEventListener('canplay', function onCanPlay() {
                    console.log("Canplay event fired, attempting to play");
                    player.play().then(() => {
                        console.log("Playback started successfully");
                        playPauseButton.textContent = "Pause";
                        animateEqualizer();
                    }).catch(err => {
                        console.error("Failed to play audio:", err);
                        isPlaying = false;
                    });
                    player.removeEventListener('canplay', onCanPlay);
                }, { once: true });
            } else if (!player.paused) {
                player.pause();
                playPauseButton.textContent = "Play";
                isPlaying = false;
            }
        }

        // Play the next song
        function shuffleSong() {
            currentSong = (currentSong + 1) % songs.length;
            player.src = songs[currentSong];
            player.load();
            updateSongTitle();
            isPlaying = true;
            player.addEventListener('canplay', function onCanPlay() {
                player.play().then(() => {
                    console.log("Next song started successfully");
                    playPauseButton.textContent = "Pause";
                    if (audioContext.state === "suspended") {
                        audioContext.resume();
                    }
                    animateEqualizer();
                }).catch(err => {
                    console.error("Failed to play next song:", err);
                    isPlaying = false;
                });
                player.removeEventListener('canplay', onCanPlay);
            }, { once: true });
        }

        // Play the previous song
        function previousSong() {
            currentSong = (currentSong - 1 + songs.length) % songs.length;
            player.src = songs[currentSong];
            player.load();
            updateSongTitle();
            isPlaying = true;
            player.addEventListener('canplay', function onCanPlay() {
                player.play().then(() => {
                    console.log("Previous song started successfully");
                    playPauseButton.textContent = "Pause";
                    if (audioContext.state === "suspended") {
                        audioContext.resume();
                    }
                    animateEqualizer();
                }).catch(err => {
                    console.error("Failed to play previous song:", err);
                    isPlaying = false;
                });
                player.removeEventListener('canplay', onCanPlay);
            }, { once: true });
        }

        // Initial setup
        player.src = songs[currentSong];
        player.load();
        updateSongTitle();
        player.addEventListener("ended", shuffleSong);
        player.addEventListener("timeupdate", updateTimer);
        player.addEventListener("loadedmetadata", updateTimer);
        player.addEventListener("error", (e) => {
            console.error("Audio loading error:", e);
        });
    </script>

    <!-- Chat Script -->
    <script>
        // Define functions in the global scope
        let connectWallet = () => {
            alert("Wallet adapter not yet initialized. Please wait...");
        };
        let disconnectWallet = () => {
            alert("Wallet adapter not yet initialized. Please wait...");
        };
        let sendMessage = () => {
            alert("Wallet adapter not yet initialized. Please wait...");
        };

        document.addEventListener("DOMContentLoaded", () => {
            // Debug to check if the script loaded
            console.log("WalletAdapterCore:", window.WalletAdapterCore);
            console.log("PetraWalletAdapter:", window.PetraWalletAdapter);

            const chatLog = document.getElementById("chat-log");
            const walletStatus = document.getElementById("wallet-status");
            const walletPrompt = document.getElementById("wallet-prompt");
            const chatInput = document.getElementById("chat-input");
            const chatMessageInput = document.getElementById("chat-message");
            let messages = JSON.parse(localStorage.getItem("chatMessages")) || [];
            let walletAddress = null;
            let adapter = null;

            // If there are no messages, add a welcome message
            if (messages.length === 0) {
                messages.push("Welcome to the nostalgia chat! Say hi to get started.");
            }

            // Display messages
            chatLog.value = messages.join("\n");

            // Initialize wallet adapter
            if (!window.WalletAdapterCore || !window.PetraWalletAdapter) {
                console.error("Failed to load Aptos Wallet Adapter scripts.");
                alert("Failed to load Aptos Wallet Adapter. Please check your network connection and try again.");
                return;
            }

            const { WalletCore, Network } = window.WalletAdapterCore;
            const { PetraWallet } = window.PetraWalletAdapter;

            const wallet = new PetraWallet();
            adapter = new WalletCore([wallet], [], { network: Network.DEVNET });

            // Redefine functions with actual implementation
            connectWallet = async () => {
                if (!adapter) {
                    alert("Wallet adapter not initialized. Please refresh the page and try again.");
                    return;
                }
                try {
                    await adapter.connect(wallet.name);
                    walletAddress = await adapter.address();
                    walletStatus.innerHTML = `<p>Connected as: ${walletAddress.slice(0, 6)}...${walletAddress.slice(-4)}</p><button onclick="disconnectWallet()" class="chat-button">Disconnect Wallet</button>`;
                    walletPrompt.style.display = "none";
                    chatInput.style.display = "flex";
                    chatMessageInput.focus();
                } catch (error) {
                    console.error("Failed to connect wallet:", error);
                    alert("Failed to connect wallet. Please ensure Petra Wallet is installed and try again.");
                }
            };

            disconnectWallet = async () => {
                try {
                    await adapter.disconnect();
                    walletAddress = null;
                    walletStatus.innerHTML = "";
                    walletPrompt.style.display = "block";
                    chatInput.style.display = "none";
                } catch (error) {
                    console.error("Failed to disconnect wallet:", error);
                    alert("Failed to disconnect wallet.");
                }
            };

            sendMessage = () => {
                if (!walletAddress) {
                    alert("Please connect your wallet first!");
                    return;
                }

                const message = chatMessageInput.value.trim();
                if (message === "") return;

                messages.push(`${walletAddress}: ${message}`);
                localStorage.setItem("chatMessages", JSON.stringify(messages));
                chatLog.value = messages.join("\n");
                chatLog.scrollTop = chatLog.scrollHeight;
                chatMessageInput.value = "";
            };

            // Allow sending messages with Enter key
            chatMessageInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    sendMessage();
                }
            });

            // Expose functions globally
            window.connectWallet = connectWallet;
            window.disconnectWallet = disconnectWallet;
            window.sendMessage = sendMessage;
        });
    </script>

    <!-- Mouse Sparkle Script -->
    <script>
        document.addEventListener("mousemove", function(e) {
            const sparkle = document.createElement("div");
            sparkle.classList.add("sparkle");
            sparkle.style.left = e.pageX + "px";
            sparkle.style.top = e.pageY + "px";
            document.body.appendChild(sparkle);
            setTimeout(() => {
                sparkle.remove();
            }, 1000);
        });
    </script>
</body>
</html>